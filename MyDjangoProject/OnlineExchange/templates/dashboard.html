<!DOCTYPE html>
<html>
<head>
    <title>首页</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <script type="text/javascript" src="/static/js/jquery-1.11.2.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/modernizer.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="/static/css/bootstrap-theme.min.css" media="screen">
    <link rel="stylesheet" href="/static/css/bootstrap.css" media="screen">
    <link type="text/css" rel="stylesheet" href="/static/css/groundwork.css">
    <script type="text/javascript">
        $(document).ready(function(){
            $("a").click(function(){
                var id = $(this).attr("id")
                var check = true
                if(id == "submitLogin"){
                    var username = $("#loginUsername").val();
                    var password = $("#loginPsw").val();
                    if(username==""){
                       if(username==""){
                        alert("手机或邮箱不能为空")
                        return;
                       }
                    }
                    if(password==""){
                        alert("密码不能为空")
                        return;
                    }
                    if(check){
                        var para = {
                            "username": username,
                            "password": password
                        }
                        $.getJSON("/login", para, function(data){
                            if(data=="00000"){
                                alert("登录成功")
                                window.location.href="/dashboard"
                            }else if(data=="44444"){
                                alert("用户名或密码错误")
                            }
                        });
                    }
                } else if(id == "logout"){
                    window.location.href = "/logout"
                } else if(id == "dashboard"){
                    window.location.href = "/dashboard"
                } else if(id == "submitRegister"){
                    var uname = $("#uname").val()
                    var tel = $("#tel").val()
                    var email = $("#email").val()
                    var psw1 = $("#registerPsw").val()
                    var psw2 = $("#registerPsw2").val()
                    if(uname==""){
                        alert("用户名不能为空")
                        return;
                    } else if(tel==""){
                        alert("手机号不能为空")
                        return;
                    } else if(email==""){
                        alert("邮箱不能为空")
                        return;
                    } else if(psw1==""){
                        alert("请输入密码")
                        return;
                    } else if(psw2==""){
                        alert("请重复输入密码")
                        return;
                    } else if(psw1 != psw2){
                        alert("密码输入不一致")
                        return;
                    }
                    var paraRegister = {
                        "uname": uname,
                        "tel": tel,
                        "email": email,
                        "password": psw1
                    }
                    $.getJSON("/register", paraRegister, function(data){
                        if(data=="00000"){
                            alert("注册成功")
                            window.location.href = "/dashboard"
                        }else if(data=="11111"){
                            alert("遇到未知错误，请重新提交")
                            return;
                        }else if(data=="33344"){
                            alert(email + " 已经被注册")
                        }else if(data=="33333"){
                            alert(tel + " 已经被注册")
                        }
                    });
                }
            });
        });
    </script>
</head>
<body>
     <header class="padded">
        <div class="container">
            <div class="row">
                <div class="one half">
                    &nbsp;&nbsp;&nbsp;&nbsp;<img src="/static/img/logo.png" style="height: 50px; width: 120px; border: NONE"/>
			    </div>
                <div class="one half">
                    {% if username %}
                    <p class="small no-pad-small-tablet align-right align-left-small-tablet"><br><br>你好, {{ uname }}&nbsp;&nbsp;&nbsp;&nbsp;<a id="logout" style="color: #ff0000;text-decoration: NONE">退出登录</a></p>
                    {% else %}
                    <p class="small no-pad-small-tablet align-right align-left-small-tablet"><br><br><a id="login" data-toggle="modal" data-target="#loginModal">登录</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a data-toggle="modal" data-target="#registerModal">注册</a></p>
                    {% endif %}
                </div>
            </div>
            <nav role="navigation" class="nav gap-top">
                <ul role="menubar">
                    <li><a id="dashboard"><i class="icon-home"></i> 首页</a></li>
                    {% if username %}
                        <li><a id="homepage"><i class="icon-male"></i> 个人主页</a></li>
                        <li><a id="necessity"><i class="icon-upload-alt"></i> 发布需求</a></li>
                        <li><a id="add"><i class="icon-plus"></i> 闲置物品</a></li>
                    {% endif %}
                </ul>
            </nav>
        </div>
     </header>




<!-- 模态框（Modal） -->
        <div class="modal fade" id="loginModal" tabindex="-1" role="dialog"
           aria-labelledby="loginLabel" aria-hidden="true">
           <div class="modal-dialog">
               <div style="height: 350px; width: 354px">
              <div class="modal-content">
                 <div class="modal-header">
                    <button type="button" class="close"
                       data-dismiss="modal" aria-hidden="true">
                          &times;
                    </button>
                    <h4 class="modal-title" id="loginLabel">
                        <center>登录</center>
                    </h4>
                 </div>
                  <form onsubmit="return false;">
                 <div class="modal-body">

                        <div class="row padded" style="margin-left: 3px">
                            <center><input type="text" placeholder="手机号/邮箱" id="loginUsername"/></center>
                        </div>
                        <div class="row padded" style="margin-left: 3px">
                            <center><input type="password" placeholder="密码" id="loginPsw"/></center>
                        </div>
                        <div class="row">
                            <span class="help-block"></span>
                        </div>
                 </div>
                 <div class="modal-footer">
                    <div class="row padded" style="margin-left: 3px">
                        <center><a class="blue button" style="width: 200px" id="submitLogin">登录</a></center>
                    </div>
                 </div>
                 </form>
              </div><!-- /.modal-content -->
           </div>
        </div>
       </div>

        <div class="modal fade" id="registerModal" tabindex="-1" role="dialog"
           aria-labelledby="registerLabel" aria-hidden="true">
           <div class="modal-dialog">
               <div style="height: 600px; width: 354px">
              <div class="modal-content">
                 <div class="modal-header">
                    <button type="button" class="close"
                       data-dismiss="modal" aria-hidden="true">
                          &times;
                    </button>
                    <h4 class="modal-title" id="registerLabel">
                        <center>注册</center>
                    </h4>
                 </div>
                 <div class="modal-body">
                    <div class="row padded" style="margin-left: 3px">
                        <center><input type="text" placeholder="请输入用户名(6-30位字符组合)" id="uname"/></center>
                    </div>
                    <div class="row padded" style="margin-left: 3px">
                        <center><input type="text" placeholder="请输入手机号" id="tel"/></center>
                    </div>
                     <div class="row padded" style="margin-left: 3px">
                        <center><input type="text" placeholder="请输入邮箱" id="email"/></center>
                    </div>
                    <div class="row padded" style="margin-left: 3px">
                        <center><input type="password" placeholder="请输入密码(6-20位数字,字母或符号的组合)" id="registerPsw"/></center>
                    </div>
                    <div class="row padded" style="margin-left: 3px">
                        <center><input type="password" placeholder="重复输入密码" id="registerPsw2"/></center>
                    </div>
                 </div>
                 <div class="modal-footer">
                    <div class="row padded" style="margin-left: 3px">
                        <center><a id="submitRegister" class="blue button" style="width: 200px" id="submitLogin">提交注册</a></center>
                    </div>
                 </div>
              </div><!-- /.modal-content -->
           </div>
        </div>
    </div>
</body>
</html>